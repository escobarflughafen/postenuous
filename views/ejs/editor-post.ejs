<%- include('common/metadata.ejs', {lang: 'en-US', title: title}) %>

<body style="font-feature-settings:'';">
    <div style="padding: 16px">
        <%- include('common/header.ejs', {loginAs: loginAs, noUserDropdown: false}) %>

        <div class="container">
            <h5 class="letter-space-neg05 font-weight-500"><%=headings%></h5>
            <br>
            <div class="">
                <form method="POST">
                    <% if (drafts) { %>
                    <div class="form-group">
                        <select class="custom-select" id="draftselector" name="draft" onchange="getDraft(this)">
                            <option value="new" selected> - choose from your drafts - </option>
                            <% for (let i=0; i<drafts.length; i++) { %>
                            <option value="<%=drafts[i].id%>"><%=drafts[i].title%> -
                                <%=drafts[i].abstract%></option>
                            <% } %>
                        </select>
                    </div>
                    <% } %>

                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <div class="input-group-text">üì∞</div>
                            </div>
                            <input name="title" type="text" class="form-control" id="titlefield" placeholder="title..."
                                <% if(post) { %> value="<%=post.title%>" <% } %>>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <div class="input-group-text">‚ÑπÔ∏è</div>
                            </div>
                            <input name="brief" type="text" class="form-control" id="brieffield" placeholder="brief..."
                                <% if(post) { %> value="<%=post.abstract%>" <% } %>>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <div class="input-group-text">üè∑Ô∏è</div>
                            </div>
                            <input name="tags" type="text" class="form-control" id="tagsfield"
                                placeholder="tags, seperate with comma..." <% if(post) { %>
                                value="<%=post.tags.join(', ')%>" <% } %>>
                        </div>
                    </div>
                    <div class="form-group">
                        <textarea name="body" class="form-control" id="posteditfield"
                            placeholder="you can format with HTML <tags/> or markdown" rows="0" oninput="autoGrow(this)"
                            onclick="initAutoGrow(this)"><% if(post) { %><%=post.body%><% } %></textarea>
                    </div>
                    <div class="form-group">
                        <div class="form-check form-check-inline">
                            <input name="isprivate" class="form-check-input" type="checkbox" id="privatepostcheckbox"
                                value="isprivate" <% if(post && post.isPrivate)  { %> checked <% } %>>
                            <label class="form-check-label" for="privatepostcheckbox">private post</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input name="disablecomment" class="form-check-input" type="checkbox"
                                id="disablecommentcheckbox" value="disablecomment"
                                <% if(post && !post.enableComment)  { %> checked <% } %>>
                            <label class="form-check-label" for="disablecommentcheckbox">disable comment</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="newdraftcheckbox" value="option3">
                            <label class="form-check-label" for="newdraftcheckbox">save as new draft</label>
                        </div>
                    </div>

                    <div style="text-align: right;">
                        <input id="preview-btn" type="button" value="Preview" class="btn btn-light mb-2" />
                        <input id="savetodraft-btn" onclick="saveToDraft(this)" class="btn btn-secondary mb-2"
                            type="button" value="Save to Drafts" formaction="/savetodraft" />
                        <input class="btn btn-primary mb-2" type="submit" <% if (post) { %> value="Modify Post"
                            <% } else { %> value="Add to Posts" <% } %> formaction="<%=formaction%>" />
                    </div>
                </form>
            </div>
        </div>
        <div class="container">
            <div id="content-display">
                <div id="content" class="post-text"></div>
            </div>
            <hr>
        </div>
        <%- include('common/footer.ejs') %>
    </div>

    <script>
        var originalContent = $('#content').html();
        var isPreviewed = false;
        $("#preview-btn").click(function () {
            $('#content').html('<hr>' + marked($('#posteditfield').val()));
            if (!isPreviewed) {
                let previewButtonClone = $('#preview-btn').clone();
                previewButtonClone.val("Remove Preview");
                previewButtonClone.click(function () {
                    $('#content').html(originalContent)
                    $('#preview-btn').text('Preview');
                    $(this).remove();
                    isPreviewed = false;
                })
                $('#content-display').append(previewButtonClone);
            }
            isPreviewed = true;
        });

    </script>
    <% if (post) { %>
    <script>
        $('#preview-btn').click();
    </script>
    <% } %>
</body>